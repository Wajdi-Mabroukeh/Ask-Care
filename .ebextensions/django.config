packages:
  yum:
    python3-devel: []
    mariadb-server: []
    mariadb-devel: []
    gcc: []

option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: settings.base
  aws:elasticbeanstalk:container:python:
    WSGIPath: settings.wsgi:application

% commands:
%   01_install_dependencies:
%     command: |
%       pip install --upgrade pip
%       python3 -m venv /opt/venv
%       export PATH="/opt/venv/bin:$PATH"
%   02_create_virtual_environment:
%     command: |
%       pip --python 3.8
%       pip install --no-cache-dir -r requirements.txt
%   03_configure_database:
%     command: |
%       pip run python manage.py migrate
%       python3 manage.py createsu
%   04_collectstatic:
%     command: |
%       pipenv run python manage.py collectstatic --noinput
%
% container_commands:
%   01_run_server:
%     command: "pip run gunicorn myproject.wsgi --bind 0.0.0.0:8000 --workers 3"

container_commands:
  01_migrate:
    command: "source /var/app/venv/staging-LQM1lest/bin/activate && python3 manage.py migrate  --noinput"
    leader_only: true
  02_collectstatic:
    command: "source /var/app/venv/staging-LQM1lest/bin/activate && python3 manage.py collectstatic --noinput"
  03_create_superuser_for_django_admin:
    command: "source /var/app/venv/staging-LQM1lest/bin/activate && python3 manage.py createsu"
    leader_only: true